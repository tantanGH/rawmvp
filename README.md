# RAWMVP.X

Raw Movie File Player for X68000Z/X680x0 (試行版)

---

## About This

ディスク上の無圧縮動画データを逐次読み取りしながら指定した画面モード・fpsで再生します。

 - ディスクから逐次読み取りを行うため再生開始までの待ち時間が短い
 - ディスクから直接GVRAMに転送を行うため高フレームレートが期待できる
 - 256x256x65536色モード及び384x256x65536色モードの2種類の画面モードに対応
 - 30FPS,20FPS,15FPSの3種類のフレームレートに対応
 - ADPCMによる音声の同期再生対応(要PCM8A.X)

ADPCM音声データはメインメモリに丸ごと読み込むため、その分のメインメモリは必要です。

基本的に X68000Z ファームウェアバージョン 1.3.1以降でUSBメモリによる擬似SCSI機能を使っている環境を前提としています。

試行版とあるように、技術検証が目的であり、厳密なデータフォーマットを定めたりはしていません。

既存のX68用動画形式のいずれかをそのまま、あるいは一部拡張して利用した方が良いのか、それとも新たに定めた方が良いのか自分だけでは決められませんので...


実際の再生例

[<img src='images/rawmvp1.png'/>](https://youtu.be/u_Py9P0lbjs)

---

## インストール

RAWMPxxx.ZIP をダウンロードして、RAWMVP.X をパスの通ったディレクトリにコピーします。

CRTMOD16.X および PCM8A.X を事前に常駐させておく必要があります。

CRTMOD16.X (M.Kamada氏) は XEiJ のインストールパッケージの中の misc ディレクトリに含まれています。

* [https://stdkmd.net/xeij/miscfiles.htm](https://stdkmd.net/xeij/miscfiles.htm)    

`crtmod16 -e` でIOCS _CRTMOD拡張モードで常駐させてください。

PCM8A.X (原作:philly氏) は TcbnErik氏によるパッチ版の使用を推奨します。

* [https://github.com/kg68k/pcm8a](https://github.com/kg68k/pcm8a)

---

## データの準備

データは以下の流れで作成します。画像データのファイル(\*.raw)と、音声データのファイル(\*.pcm)は別のままで、2つのファイルとなります。

1. 任意の動画データから、各フレーム画像を 256x256 または 384x256 のサイズで連番BMPとして保存する。

ffmpeg などで作ることができます。

2. 連番のBMPデータをX680x0 GVRAM形式に変換した上で連結して一つのファイルとする。

横384の画像の場合、右側にパディングして横512にする必要があります。

拙作の [bmp2raw](https://github.com/tantanGH/bmp2raw) を使うと自動的に作ることができます。

3. 音声データを抜き出し、X68k ADPCM形式として保存する。

こちらも ffmpeg で 15625Hz のPCMデータを出力し、拙作の [pcm2adpcm](https://github.com/tantanGH/pcm2adpcm) などを使うことができます。

---

## 再生方法

    usage: rawmvp <screen-width> <view-height> <fps> <raw-movie-file> <adpcm-file>

5つのコマンドライン引数を指定します。

* screen-width

256 または 384 を指定します。元データの各フレームの横幅と一致している必要があります。

* view-height

表示する画像の高さを1から256で指定します。元データの各フレームの縦幅と一致している必要があります。

* fps

30, 20, 15 のいずれかを指定します。

なお、横256の時と横384の時でVSYNC周波数の違いによる厳密なfpsが変わります。
元データは必ずこの数値に合わせて作っておく必要があります。MACSDRV(改造版)のようなインテリジェントな自動調整機能はありません。

|指定値|横256|横384|
-|-|-
|30|27.729|28.137|
|20|18.486|18.758|
|15|13.865|14.068|

なお、再生が間に合わない場合は、音と絵がだんだんずれていきます。フレームスキップして追いつく機能は実装されていません。

* raw-movie-file

ベタ画像データファイル名を指定します。ファイルサイズは1.5GB程度までは確認しています。

* adpcm-file

ADPCMファイル名を指定します。15625Hz前提となります。

---

## 変更履歴

* 0.1.0 (2023/08/07) ... 初版